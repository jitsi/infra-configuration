---

- name: create home directory for www-data user
  file: path=/var/www/html state=directory owner="www-data" group="www-data" recurse=yes

#clear out default site installed
- file: path=/etc/nginx/sites-enabled/default state=absent
  notify: restart nginx

- name: Deploy jigasi web page
  template: src=jigasi_user.html.j2 dest="/var/www/html/index.html"

- name: Deploy jigasi website configuration
  template: src=nginx.site.j2 dest=/etc/nginx/sites-available/jigasi mode=0644
  notify: restart nginx

- file: src=/etc/nginx/sites-available/jigasi dest=/etc/nginx/sites-enabled/jigasi state=link
  notify: restart nginx

- name: Ensure handlers are notified now to avoid firewall conflicts.
  meta: flush_handlers